<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <title>Registering Malware</title>
    </head>
<body>

<?php

require_once('allmalwares.php');

///CHECK FOR VALID TYPE

function check_string($s) {
    if (!preg_match('/[^A-Za-z0-9]/', $mname) && strlen($mname) > 0) // '/[^a-z\d]/i' should also work.
    {
    echo "string contains only english letters & digits";
    return true;
    }
    else
    {
        echo "string is invalid";
        return false;
    }
}

function get_twenty($f) {
    $fh = fopen($f,'r') or die("Could not open file.");
    echo "Opening file...<br>";
    // read first 20
}

if ($_FILES && $_FILES['infile']['type']) {
    echo "Recieved file.  <br>  ";

    //// INVALID FILE
    if ($_FILES['infile']['type'] != 'text/plain') {
        echo 'Invalid file. Txt accepted only.<br>';
    }

    //// VALID FILE
    else {
        echo 'Valid file. <br>';
        $mname = $_GET['mname'];
        if (check_string($mname))
        {
            get_twenty($_FILES['inFile']['tmp_name']);
        };
    }
}
//// NO FILE RECIEVED
else {
    echo "Currently holds no files.<br>";
}
?>

<div>
    <form action="uploadmalware.php"
        method="post"
        enctype="multipart/form-data">
        <fieldset>
            <legend>Upload malware</legend>
            <p>
                <label>Malware name: </label>
                <input name="mname" type="text"/>
            </p>
            <p>
                <label>Upload file: </label><br>
                <input type="file" name="infile" id="infile">
            </p>
            <p>
                <input type="submit">
            </p>
        </fieldset>
    </form>
</div>
<div>
    <form method="post" action="welcomeadmin.html">
        <button type="submit">Go to Admin Home</button>
</div>
</body>
</html>