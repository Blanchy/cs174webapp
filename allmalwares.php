<?php

/**
 * 
 * Blanchy Polangcos
 * 
 * prints table of malware
 * 
 */
    if(session_id() == '') {
        session_start();
    }
    if ($_SESSION['check'] != hash('ripemd128', $_SERVER['REMOTE_ADDR'] .
    $_SERVER['HTTP_USER_AGENT'])) {
        echo "Your current location does not match the one given for this session. Try logging in again.";
        require_once("logout.php");
        exit;
    }
    
    if (isset($_SESSION['un'])) {
        
        if ($_SESSION['type'] == 0) {
            print_tables();
        }
        else echo 'You are not authorized to see this page.<br>';
    }
    else {
        echo 'Allmalwares: No user set.<br>';
        exit;
    }

    /**
     * print table of malware name and signature
     */
    function print_tables() {
        require("dbproperties.php"); // require_once doesn't work here???
        $conn = new mysqli($host, $un, $pw, $db);
        if ($conn->connect_error) die($conn->connect_error);
        $query = "SELECT mname, signature FROM malwares";
        $result = $conn->query($query);
        if ($result->num_rows > 0) {
            $table = "<table border=\"1\">";
            $table .=   "<tr>
                            <th>NAME</th>
                            <th>SIGNATURE</th>
                        </tr>";
            while ($row = $result->fetch_assoc()) {
                $table .=   "<tr>
                                <td>
                                    ".$row['mname']."
                                </td>
                                <td>
                                    ".$row['signature']."
                                </td>
                            </tr>";
            }
            $table .= "</table>";
        }
        else {
            $table = "Database currently holds no malware signatures.";
        }        
        $conn->close();
        return $table;
    }
?>